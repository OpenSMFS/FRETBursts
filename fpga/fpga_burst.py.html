<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>~/ucla/burst/fpga_burst.py.html</title>
<meta name="Generator" content="Vim/7.3">
<meta name="plugin-version" content="vim7.3_v6">
<meta name="syntax" content="python">
<meta name="settings" content="use_css">
<style type="text/css">
<!--
pre { font-family: monospace; color: #000000; background-color: #ffffff; }
body { font-family: monospace; color: #000000; background-color: #ffffff; }
.Statement { color: #a52a2a; font-weight: bold; }
.Comment { color: #0000ff; }
.Identifier { color: #008b8b; }
.Constant { color: #ff00ff; }
-->
</style>
</head>
<body>
<pre>
m = <span class="Constant">3</span>

prefilling = <span class="Identifier">True</span>   <span class="Comment"># (bool) Non-default init</span>
buffered_ph = <span class="Constant">0</span>     <span class="Comment"># (uint8)</span>
in_burst = <span class="Identifier">False</span>    <span class="Comment"># (bool)        </span>
burst_start = <span class="Constant">0</span>     <span class="Comment"># (uint32)</span>
num_ph = <span class="Constant">0</span>          <span class="Comment"># (uint16)</span>
num_ph_donor = <span class="Constant">0</span>    <span class="Comment"># (uint16)</span>
donors_in_window = <span class="Constant">0</span> <span class="Comment"># (uint8)</span>

<span class="Statement">def</span> <span class="Identifier">fpga_burst_search</span>(t,data_avail,donor, T, L):
    <span class="Constant">&quot;&quot;&quot;Function executed at every clock cycle.&quot;&quot;&quot;</span>
    <span class="Statement">global</span> prefilling, buffered_ph, t_start, in_burst, num_ph, num_ph_donor

    burst_available = <span class="Identifier">False</span>
    out_burst_start,out_burst_width,out_burst_size,out_burst_size_donor=[<span class="Constant">0</span>,<span class="Constant">0</span>,<span class="Constant">0</span>,<span class="Constant">0</span>]
    <span class="Statement">if</span> data_avail: <span class="Comment"># T</span>
        t_start_fifo.append(t)
        donor_fifo.append(donor)
        <span class="Statement">if</span> prefilling: <span class="Comment"># T T</span>
            buffered_ph += <span class="Constant">1</span>
            prefilling = (buffered_ph &lt; m-<span class="Constant">1</span>)
        <span class="Statement">else</span>: <span class="Comment"># T F</span>
            t_start = t_start_fifo.pop(<span class="Constant">0</span>)
            donors_in_window = donor_counter(donor_fifo)
            <span class="Statement">if</span> t-t_start &lt;= T: <span class="Comment"># T F T      (ABOVE the min rate)</span>
                <span class="Statement">if</span> <span class="Statement">not</span> in_burst: <span class="Comment"># T F T F</span>
                    in_burst = <span class="Identifier">True</span>
                    burst_start = t_start
                    num_ph = m
                    num_ph_donor = donors_in_window
                <span class="Statement">else</span>: <span class="Comment"># T F T T</span>
                    num_ph += <span class="Constant">1</span>
                    <span class="Statement">if</span> donor: num_ph_donor += <span class="Constant">1</span>
            <span class="Statement">else</span>: <span class="Comment"># T F F                   (BELOW the min rate)</span>
                <span class="Statement">if</span> in_burst: <span class="Comment"># T F F T</span>
                    in_burst = <span class="Identifier">False</span>
                    <span class="Statement">if</span> num_ph &gt;= L: <span class="Comment"># T F F T T</span>
                        burst_available = <span class="Identifier">True</span>
                        out_burst_start = burst_start
                        out_burst_end = t_secondlast
                        out_burst_width = burst_end - burst_start
                        out_burst_size = num_ph
                        out_burst_size_donor = num_ph_donor
                    <span class="Statement">else</span>: <span class="Comment"># T F F T F</span>
                        <span class="Statement">pass</span>
                <span class="Statement">else</span>: <span class="Comment"># T F F F</span>
                    <span class="Statement">pass</span>
                num_ph = <span class="Constant">0</span>
                num_ph_donor = <span class="Constant">0</span>

    <span class="Statement">yield</span> burst_available,
        out_burst_start, out_burst_width, out_burst_size, out_burst_size_donor



</pre>
</body>
</html>
